<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
      background: #f0f8ff;
      position: relative;
    }
    button {
      font-size: 20px;
      margin: 10px;
      padding: 10px 20px;
    }
    #cpu-hand {
      font-size: 100px;
      margin: 30px 0 10px;
    }
    #result {
      font-size: 24px;
      margin: 10px 0;
    }
    .counter {
      margin-top: 20px;
      font-size: 16px;
    }
    .top-buttons {
      position: absolute;
      top: 10px;
      right: 10px;
    }
    .top-buttons button {
      font-size: 24px;
      background: none;
      border: none;
      cursor: pointer;
    }
    .favorited {
      color: gold;
    }
    .back-button {
      margin-top: 40px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div class="top-buttons">
    <button id="favoriteBtn">â˜…</button>
  </div>

  <h1>ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ </h1>
  <p>æ‰‹ã‚’é¸ã‚“ã§ãã ã•ã„ï¼</p>
  <div id="cpu-hand">â“</div>
  <h2 id="result">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</h2>

  <div>
    <button onclick="play('ã‚°ãƒ¼')">ã‚°ãƒ¼ âœŠ</button>
    <button onclick="play('ãƒãƒ§ã‚­')">ãƒãƒ§ã‚­ âœŒ</button>
    <button onclick="play('ãƒ‘ãƒ¼')">ãƒ‘ãƒ¼ ğŸ–</button>
  </div>

  <div class="counter">
    å‹ã¡: <span id="winCount">0</span> / è² ã‘: <span id="loseCount">0</span> / ã‚ã„ã“: <span id="drawCount">0</span><br>
    é€£å‹è¨˜éŒ²: <span id="streak">0</span>
  </div>

  <button class="back-button" onclick="location.href='../../index.html'">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>

  <audio id="winSound" src="https://soundeffect-lab.info/sound/voice/mp3/girl1-yorokobi1.mp3" preload="auto"></audio>
  <audio id="loseSound" src="https://soundeffect-lab.info/sound/voice/mp3/girl1-shock1.mp3" preload="auto"></audio>
  <audio id="drawSound" src="https://soundeffect-lab.info/sound/voice/mp3/decision37.mp3" preload="auto"></audio>

  <script>
    const hands = ['ã‚°ãƒ¼', 'ãƒãƒ§ã‚­', 'ãƒ‘ãƒ¼'];
    const emojis = { 'ã‚°ãƒ¼': 'âœŠ', 'ãƒãƒ§ã‚­': 'âœŒ', 'ãƒ‘ãƒ¼': 'ğŸ–' };
    const cpuHandElem = document.getElementById('cpu-hand');
    const resultElem = document.getElementById('result');
    const winElem = document.getElementById('winCount');
    const loseElem = document.getElementById('loseCount');
    const drawElem = document.getElementById('drawCount');
    const streakElem = document.getElementById('streak');
    const favoriteBtn = document.getElementById('favoriteBtn');

    let winCount = 0, loseCount = 0, drawCount = 0, streak = 0;
    let intervalId;

    function startCpuThinking() {
      intervalId = setInterval(() => {
        const random = hands[Math.floor(Math.random() * 3)];
        cpuHandElem.textContent = emojis[random];
      }, 100);
    }

    function stopCpuThinking() {
      clearInterval(intervalId);
    }

    startCpuThinking();

    function play(playerHand) {
      stopCpuThinking();
      const cpuHand = hands[Math.floor(Math.random() * 3)];
      cpuHandElem.textContent = emojis[cpuHand];

      let result = '';
      let sound;
      if (playerHand === cpuHand) {
        result = 'ã‚ã„ã“ï¼';
        drawCount++;
        sound = 'drawSound';
        streak = 0;
      } else if (
        (playerHand === 'ã‚°ãƒ¼' && cpuHand === 'ãƒãƒ§ã‚­') ||
        (playerHand === 'ãƒãƒ§ã‚­' && cpuHand === 'ãƒ‘ãƒ¼') ||
        (playerHand === 'ãƒ‘ãƒ¼' && cpuHand === 'ã‚°ãƒ¼')
      ) {
        result = 'ã‚ãªãŸã®å‹ã¡ï¼';
        winCount++;
        streak++;
        sound = 'winSound';
      } else {
        result = 'ã‚ãªãŸã®è² ã‘ï¼';
        loseCount++;
        streak = 0;
        sound = 'loseSound';
      }
      resultElem.innerText = `ã‚ãªãŸï¼š${playerHand} ï¼ ç›¸æ‰‹ï¼š${cpuHand} â†’ ${result}`;
      winElem.textContent = winCount;
      loseElem.textContent = loseCount;
      drawElem.textContent = drawCount;
      streakElem.textContent = streak;

      const audio = document.getElementById(sound);
      audio.volume = 0.2;
      audio.play();

      setTimeout(startCpuThinking, 1000);
    }

    // ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³é€£æº
    const gameId = "janken";
    function getFavorites() {
      return JSON.parse(localStorage.getItem("favorites") || "[]");
    }

    function setFavoriteUI(isFav) {
      favoriteBtn.classList.toggle("favorited", isFav);
    }

    function toggleFavorite() {
      let favs = getFavorites();
      if (favs.includes(gameId)) {
        favs = favs.filter(f => f !== gameId);
        setFavoriteUI(false);
      } else {
        favs.push(gameId);
        setFavoriteUI(true);
      }
      localStorage.setItem("favorites", JSON.stringify(favs));
    }

    favoriteBtn.onclick = toggleFavorite;
    setFavoriteUI(getFavorites().includes(gameId));
  </script>
</body>
</html>
