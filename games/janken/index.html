<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ </title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 50px; background: #f9f9f9; }
    button { font-size: 20px; margin: 10px; padding: 10px 20px; }
    #cpuHand { font-size: 80px; margin: 20px; }
    #result { font-size: 24px; margin: 20px; }
    #streaks { margin: 20px; font-size: 18px; }
    #backBtn, #favoriteBtn { position: fixed; bottom: 20px; font-size: 20px; padding: 10px; }
    #backBtn { left: 20px; }
    #favoriteBtn { right: 20px; background: none; border: none; font-size: 30px; cursor: pointer; }
    #favoriteBtn.favorited { color: gold; }
  </style>
</head>
<body>
  <h1>ã˜ã‚ƒã‚“ã‘ã‚“ã‚²ãƒ¼ãƒ </h1>
  <div>
    <button onclick="play('ã‚°ãƒ¼')">ã‚°ãƒ¼ âœŠ</button>
    <button onclick="play('ãƒãƒ§ã‚­')">ãƒãƒ§ã‚­ âœŒ</button>
    <button onclick="play('ãƒ‘ãƒ¼')">ãƒ‘ãƒ¼ ğŸ–</button>
  </div>
  <div id="cpuHand">â“</div>
  <h2 id="result">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</h2>
  <div id="streaks">
    ç¾åœ¨ã®é€£å‹æ•°: <span id="currentStreak">0</span><br>
    æœ€å¤§é€£å‹æ•°: <span id="maxStreak">0</span>
  </div>
  <button onclick="resetStreaks()">è¨˜éŒ²ãƒªã‚»ãƒƒãƒˆ</button>
  <button id="backBtn" onclick="location.href='../../index.html'">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
  <button id="favoriteBtn" onclick="toggleFavorite()">â˜…</button>

  <script>
    const hands = ['ã‚°ãƒ¼', 'ãƒãƒ§ã‚­', 'ãƒ‘ãƒ¼'];
    let currentStreak = 0;
    let maxStreak = localStorage.getItem('janken_maxStreak') || 0;
    document.getElementById('maxStreak').innerText = maxStreak;

    let cpuInterval;
    let isPlaying = false;

    const handEmojis = {
      'ã‚°ãƒ¼': 'âœŠ',
      'ãƒãƒ§ã‚­': 'âœŒ',
      'ãƒ‘ãƒ¼': 'ğŸ–'
    };

    function startCpuShuffle() {
      const cpuHandElem = document.getElementById('cpuHand');
      let i = 0;
      cpuInterval = setInterval(() => {
        cpuHandElem.innerText = handEmojis[hands[i % 3]];
        i++;
      }, 100);
    }

    function stopCpuShuffle() {
      clearInterval(cpuInterval);
    }

    function play(playerHand) {
      if (isPlaying) return;
      isPlaying = true;

      stopCpuShuffle();
      startCpuShuffle();

      setTimeout(() => {
        stopCpuShuffle();
        const cpuHand = hands[Math.floor(Math.random() * 3)];
        document.getElementById('cpuHand').innerText = handEmojis[cpuHand];

        let result = '';
        if (playerHand === cpuHand) {
          result = 'ã‚ã„ã“ï¼';
          currentStreak = 0;
        } else if (
          (playerHand === 'ã‚°ãƒ¼' && cpuHand === 'ãƒãƒ§ã‚­') ||
          (playerHand === 'ãƒãƒ§ã‚­' && cpuHand === 'ãƒ‘ãƒ¼') ||
          (playerHand === 'ãƒ‘ãƒ¼' && cpuHand === 'ã‚°ãƒ¼')
        ) {
          result = 'ã‚ãªãŸã®å‹ã¡ï¼';
          currentStreak++;
          if (currentStreak > maxStreak) {
            maxStreak = currentStreak;
            localStorage.setItem('janken_maxStreak', maxStreak);
          }
        } else {
          result = 'ã‚ãªãŸã®è² ã‘ï¼';
          currentStreak = 0;
        }

        document.getElementById('result').innerText = `ã‚ãªãŸï¼š${playerHand} ï¼ ç›¸æ‰‹ï¼š${cpuHand} â†’ ${result}`;
        document.getElementById('currentStreak').innerText = currentStreak;
        document.getElementById('maxStreak').innerText = maxStreak;
        isPlaying = false;
      }, 1000);
    }

    function resetStreaks() {
      currentStreak = 0;
      maxStreak = 0;
      localStorage.setItem('janken_maxStreak', 0);
      document.getElementById('currentStreak').innerText = '0';
      document.getElementById('maxStreak').innerText = '0';
    }

    // ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ï¼ˆé€£å‹•ï¼‰
    const favoriteBtn = document.getElementById('favoriteBtn');
    function updateFavoriteIcon() {
      const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
      if (favorites.includes('janken')) {
        favoriteBtn.classList.add('favorited');
      } else {
        favoriteBtn.classList.remove('favorited');
      }
    }

    function toggleFavorite() {
      let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
      if (favorites.includes('janken')) {
        favorites = favorites.filter(f => f !== 'janken');
      } else {
        favorites.push('janken');
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      updateFavoriteIcon();
    }

    updateFavoriteIcon();
    startCpuShuffle();
  </script>
</body>
</html>
